---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(tidyverse)
library(rmangal)
library(magrittr)
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

```{r}
pollination_interactions<- search_interactions(type = "mutualism")

```
```{r}
network_ids = unique(pollination_interactions$network_id)
length(network_ids)
```

```{r,warning = FALSE,message = FALSE}
all_networks_data = data.frame()
for (i in 1:length(network_ids)) #length(pollination_networks)
{
  networks = search_networks(list(id=nth(network_ids,i)))  %>% get_collection
  network = networks[[1]]
  network_reference = network$reference %>% pull (doi)
  node_data =  network$nodes %>% select (node_id,node_name = (original_name)) #original_name
  curr_network_data = network$interactions %>% select (network_id,node_from, node_to,value,date,attribute.name,) %>% inner_join(node_data, by = c("node_from" = "node_id"  )) %>% rename (node_from_name = node_name   ) %>% inner_join(node_data, by = c("node_to" = "node_id"  )) %>% rename (node_to_name = node_name   ) %>% group_by(network_id,node_from_name,node_to_name) %>% summarise(total_interactions = sum(value)) %>% mutate(doi = network_reference, loop_i = i)
all_networks_data  = bind_rows(all_networks_data,curr_network_data)
write_csv(all_networks_data,"all_rmangal_networks_tmp.csv")
  
}

```

```{r}
all_networks_data
write_csv(all_networks_data,"all_rmangal_networks_new.csv")
```

