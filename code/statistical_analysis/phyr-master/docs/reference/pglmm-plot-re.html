<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Visualize random terms of communityPGLMMs — pglmm_plot_ranef • phyr</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Visualize random terms of communityPGLMMs — pglmm_plot_ranef" />
<meta property="og:description" content="Plot variance-cov matrix of random terms; also it is optional to simulate and
visualize data based on these var-cov matrices. The input can be a communityPGLMM
model (by setting argument x). If no model has been fitted, you can also specify
data, formula, and family, etc. without actually fitting the model, which will
save time." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">phyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/benchmarks.html">Performance benchmark</a>
    </li>
    <li>
      <a href="../articles/pglmm.html">Usage of pglmm()</a>
    </li>
    <li>
      <a href="../articles/phyr_example_empirical.html">pglmm example with empirical data</a>
    </li>
    <li>
      <a href="../articles/plot-re.html">Plot random terms of communityPGLMM</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/daijiang/phyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Visualize random terms of communityPGLMMs</h1>
    <small class="dont-index">Source: <a href='https://github.com/daijiang/phyr/blob/master/R/pglmm-plot.R'><code>R/pglmm-plot.R</code></a></small>
    <div class="hidden name"><code>pglmm-plot-re.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Plot variance-cov matrix of random terms; also it is optional to simulate and
visualize data based on these var-cov matrices. The input can be a communityPGLMM
model (by setting argument <code>x</code>). If no model has been fitted, you can also specify
data, formula, and family, etc. without actually fitting the model, which will
save time.</p>
    </div>

    <pre class="usage"><span class='fu'>pglmm_plot_ranef</span><span class='op'>(</span>
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  data <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  sp.var <span class='op'>=</span> <span class='st'>"sp"</span>,
  site.var <span class='op'>=</span> <span class='st'>"site"</span>,
  tree <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree_site <span class='op'>=</span> <span class='cn'>NULL</span>,
  repulsion <span class='op'>=</span> <span class='cn'>FALSE</span>,
  x <span class='op'>=</span> <span class='cn'>NULL</span>,
  show.image <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.sim.image <span class='op'>=</span> <span class='cn'>FALSE</span>,
  random.effects <span class='op'>=</span> <span class='cn'>NULL</span>,
  add.tree.sp <span class='op'>=</span> <span class='cn'>TRUE</span>,
  add.tree.site <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cov_ranef <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree.panel.space <span class='op'>=</span> <span class='fl'>0.5</span>,
  title.space <span class='op'>=</span> <span class='fl'>5</span>,
  tree.size <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>communityPGLMM.show.re</span><span class='op'>(</span>
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  data <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  sp.var <span class='op'>=</span> <span class='st'>"sp"</span>,
  site.var <span class='op'>=</span> <span class='st'>"site"</span>,
  tree <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree_site <span class='op'>=</span> <span class='cn'>NULL</span>,
  repulsion <span class='op'>=</span> <span class='cn'>FALSE</span>,
  x <span class='op'>=</span> <span class='cn'>NULL</span>,
  show.image <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.sim.image <span class='op'>=</span> <span class='cn'>FALSE</span>,
  random.effects <span class='op'>=</span> <span class='cn'>NULL</span>,
  add.tree.sp <span class='op'>=</span> <span class='cn'>TRUE</span>,
  add.tree.site <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cov_ranef <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree.panel.space <span class='op'>=</span> <span class='fl'>0.5</span>,
  title.space <span class='op'>=</span> <span class='fl'>5</span>,
  tree.size <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>pglmm_plot_re</span><span class='op'>(</span>
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  data <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  sp.var <span class='op'>=</span> <span class='st'>"sp"</span>,
  site.var <span class='op'>=</span> <span class='st'>"site"</span>,
  tree <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree_site <span class='op'>=</span> <span class='cn'>NULL</span>,
  repulsion <span class='op'>=</span> <span class='cn'>FALSE</span>,
  x <span class='op'>=</span> <span class='cn'>NULL</span>,
  show.image <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.sim.image <span class='op'>=</span> <span class='cn'>FALSE</span>,
  random.effects <span class='op'>=</span> <span class='cn'>NULL</span>,
  add.tree.sp <span class='op'>=</span> <span class='cn'>TRUE</span>,
  add.tree.site <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cov_ranef <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree.panel.space <span class='op'>=</span> <span class='fl'>0.5</span>,
  title.space <span class='op'>=</span> <span class='fl'>5</span>,
  tree.size <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>communityPGLMM.plot.re</span><span class='op'>(</span>
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  data <span class='op'>=</span> <span class='cn'>NULL</span>,
  family <span class='op'>=</span> <span class='st'>"gaussian"</span>,
  sp.var <span class='op'>=</span> <span class='st'>"sp"</span>,
  site.var <span class='op'>=</span> <span class='st'>"site"</span>,
  tree <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree_site <span class='op'>=</span> <span class='cn'>NULL</span>,
  repulsion <span class='op'>=</span> <span class='cn'>FALSE</span>,
  x <span class='op'>=</span> <span class='cn'>NULL</span>,
  show.image <span class='op'>=</span> <span class='cn'>TRUE</span>,
  show.sim.image <span class='op'>=</span> <span class='cn'>FALSE</span>,
  random.effects <span class='op'>=</span> <span class='cn'>NULL</span>,
  add.tree.sp <span class='op'>=</span> <span class='cn'>TRUE</span>,
  add.tree.site <span class='op'>=</span> <span class='cn'>FALSE</span>,
  cov_ranef <span class='op'>=</span> <span class='cn'>NULL</span>,
  tree.panel.space <span class='op'>=</span> <span class='fl'>0.5</span>,
  title.space <span class='op'>=</span> <span class='fl'>5</span>,
  tree.size <span class='op'>=</span> <span class='fl'>3</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>formula</th>
      <td><p>A two-sided linear formula object describing the
mixed effects of the model.</p>
<p>To specify that a random term should have phylogenetic covariance matrix along
with non-phylogenetic one, add <code>__</code> (two underscores) at the end of the group variable;
e.g., <code>+ (1 | sp__)</code> will construct two random terms,
one with phylogenetic covariance matrix and another with non-phylogenetic (identity) matrix.
In contrast, <code>__</code> in the nested terms (below) will only create a phylogenetic covariance matrix.
Nested random terms have the general form <code>(1|sp__@site__)</code> which represents
phylogenetically related species nested within correlated sites.
This form can be used for bipartite questions. For example, species could be
phylogenetically related pollinators and sites could be phylogenetically related plants, leading to
the random effect <code>(1|insects__@plants__)</code>. If more than one phylogeny is used, remember to add
all to the argument <code>cov_ranef = list(insects = insect_phylo, plants = plant_phylo)</code>. Phylogenetic correlations can
be dropped by removing the <code>__</code> underscores. Thus, the form <code>(1|sp@site__)</code> excludes the phylogenetic
correlations among species, while the form <code>(1|sp__@site)</code> excludes the correlations among sites.</p>
<p>Note that correlated random terms are not allowed. For example,
<code>(x|g)</code> will be the same as <code>(0 + x|g)</code> in the <code><a href='https://rdrr.io/pkg/lme4/man/lmer.html'>lme4::lmer</a></code> syntax. However,
<code>(x1 + x2|g)</code> won't work, so instead use  <code>(x1|g) + (x2|g)</code>.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>A <code><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></code> containing the variables named in formula.</p></td>
    </tr>
    <tr>
      <th>family</th>
      <td><p>Either "gaussian" for a Linear Mixed Model, or
"binomial" or "poisson" for Generalized Linear Mixed Models.
"family" should be specified as a character string (i.e., quoted). For binomial and
Poisson data, we use the canonical logit and log link functions, respectively.
Binomial data can be either presence/absence, or a two-column array of 'successes' and 'failures'.
For both binomial  and Poisson data, we add an observation-level
random term by default via <code>add.obs.re = TRUE</code>. If <code>bayes = TRUE</code> there are
two additional families available: "zeroinflated.binomial", and "zeroinflated.poisson",
which add a zero inflation parameter; this parameter gives the probability that the response is
a zero. The rest of the parameters of the model then reflect the "non-zero" part part
of the model. Note that "zeroinflated.binomial" only makes sense for success/failure
response data.</p></td>
    </tr>
    <tr>
      <th>sp.var</th>
      <td><p>The variable name of "species"; y-axis of the image.</p></td>
    </tr>
    <tr>
      <th>site.var</th>
      <td><p>The variable name of "site"; x-axis of the image.</p></td>
    </tr>
    <tr>
      <th>tree</th>
      <td><p>A phylogeny for column sp, with "phylo" class, or a covariance matrix for sp.
Make sure to have all species in the matrix; if the matrix is not standardized,
(i.e., det(tree) != 1), <code>pglmm</code> will try to standardize it for you.
No longer used: keep here for compatibility.</p></td>
    </tr>
    <tr>
      <th>tree_site</th>
      <td><p>A second phylogeny for "site". This is required only if the
site column contains species instead of sites. This can be used for bipartitie
questions; tree_site can also be a covariance matrix. Make sure to have all sites
in the matrix; if the matrix is not standardized (i.e., det(tree_site) != 1),
pglmm` will try to standardize it for you. No longer used: keep here for compatibility.</p></td>
    </tr>
    <tr>
      <th>repulsion</th>
      <td><p>When there are nested random terms specified, <code>repulsion = FALSE</code> tests
for phylogenetic underdispersion while <code>repulsion = FALSE</code> tests for overdispersion.
This argument is a logical vector of length either 1 or &gt;1.
If its length is 1, then all covariance matrices in nested terms will be either
inverted (overdispersion) or not. If its length is &gt;1, then you can select
which covariance matrix in the nested terms to be inverted. Make sure to get
the length right: for all the terms with <code><a href='https://rdrr.io/r/base/slotOp.html'>@</a></code>, count the number of "__"
to determine the length of repulsion. For example, <code>sp__@site</code> and <code>sp@site__</code>
will each require one element of <code>repulsion</code>, while <code>sp__@site__</code> will take two
elements (repulsion for sp and repulsion for site). Therefore, if your nested terms are
<code>(1|sp__@site) + (1|sp@site__) + (1|sp__@site__)</code>, then you should set the
repulsion to be something like <code><a href='https://rdrr.io/r/base/c.html'>c(TRUE, FALSE, TRUE, TRUE)</a></code> (length of 4).</p></td>
    </tr>
    <tr>
      <th>x</th>
      <td><p>A fitted model with class communityPGLMM.</p></td>
    </tr>
    <tr>
      <th>show.image</th>
      <td><p>Whether to show the images of random effects.</p></td>
    </tr>
    <tr>
      <th>show.sim.image</th>
      <td><p>Whether to show the images of simulated site by sp matrix.
This can be useful to see how the phylogenetic information were included.</p></td>
    </tr>
    <tr>
      <th>random.effects</th>
      <td><p>Optional pre-build list of random effects. If <code>NULL</code> (the default),
the function <code><a href='prep_dat_pglmm.html'>prep_dat_pglmm</a></code> will prepare the random effects for you from the information
in <code>formula</code>, <code>data</code>, and <code>cov_ranef</code>. <code>random.effect</code> allows a list of
pre-generated random effects terms to increase flexibility; for example, this makes it
possible to construct models with both phylogenetic correlation and spatio-temporal autocorrelation.
In preparing <code>random.effect</code>, make sure that the orders of rows and columns of
covariance matrices in the list are the same as their corresponding group variables
in the data. Also, this should be <em>a list of lists</em>, e.g.
<code>random.effects = list(re1 = list(matrix_a), re2 = list(1, sp = sp, covar = Vsp))</code>.</p></td>
    </tr>
    <tr>
      <th>add.tree.sp</th>
      <td><p>Whether to add a phylogeny of species at the top of the
simulated site by sp matrix plot, default is TRUE.</p></td>
    </tr>
    <tr>
      <th>add.tree.site</th>
      <td><p>Whether to add a phylogeny of sites at the right of the
simulated site by sp matrix plot, default is FALSE.</p></td>
    </tr>
    <tr>
      <th>cov_ranef</th>
      <td><p>A named list of covariance matrices of random terms. The names should be the
group variables that are used as random terms with specified covariance matrices
(without the two underscores, e.g. <code><a href='https://rdrr.io/r/base/list.html'>list(sp = tree1, site = tree2)</a></code>). The actual object
can be either a phylogeny with class "phylo" or a prepared covariance matrix. If it is a phylogeny,
<code>pglmm</code> will prune it and then convert it to a covariance matrix assuming Brownian motion evolution.
<code>pglmm</code> will also standardize all covariance matrices to have determinant of one. Group variables
will be converted to factors and all covariance matrices will be rearranged so that rows and
columns are in the same order as the levels of their corresponding group variables.</p></td>
    </tr>
    <tr>
      <th>tree.panel.space</th>
      <td><p>The number of lines between the phylogeny and
the matrix plot, if add.tree is TRUE.</p></td>
    </tr>
    <tr>
      <th>title.space</th>
      <td><p>The number of lines between the title and the matrix plot, if add.tree is TRUE.</p></td>
    </tr>
    <tr>
      <th>tree.size</th>
      <td><p>The height of the phylogeny to be plotted (number of lines), if add.tree is TRUE.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments for <code>Matrix::image()</code> or <code><a href='https://rdrr.io/pkg/lattice/man/levelplot.html'>lattice::levelplot()</a></code>.
Common ones are:</p><ul>
<li><p><code>useAbs</code> whether to use absolute values of the matrix; if no negative values,
this will be set to TRUE if not specified. When <code>useAbs = TRUE</code> the color scheme
will be black-white, otherwise, it will be red/blue.</p></li>
<li><p><code>colorkey</code> whether to draw the scale legend at the right side of each plot?</p></li>
</ul></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A hidden list, including the covariance matrices and simulated site by species matrices.
Individual plots are saved as <code>plt_re_list</code> and <code>plt_sim_list</code>. If <code>show.image</code> or
<code>show.sim.image</code> is TRUE, the corresponding final plot (<code>plt_re_all_in_one</code> or
<code>plt_sim_all_in_one</code>) can be saved as external file using <code><a href='https://ggplot2.tidyverse.org/reference/ggsave.html'>ggplot2::ggsave</a></code> as
it is a grid object.</p>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Anthony Ives, Russell Dinnage, Lucas A. Nell, Matthew Helmus, Daijiang Li.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


